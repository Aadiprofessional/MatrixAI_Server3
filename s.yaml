edition: 1.0.0
name: matrixai-server
access: default

services:
  matrixai-server:
    component: fc
    props:
      region: cn-hangzhou
      service:
        name: matrixai-server
        description: MatrixAI Server
        internetAccess: true
        logConfig:
          project: matrixai-log-project
          logstore: fc-invocation-logs
      function:
        name: main
        description: Main HTTP handler
        runtime: nodejs18
        codeUri: ./
        handler: index.handler
        memorySize: 1024
        timeout: 900
        environmentVariables:
          ENVIRONMENT: production
          NODE_ENV: production
          SUPABASE_URL: ${env.SUPABASE_URL}
          SUPABASE_ANON_KEY: ${env.SUPABASE_ANON_KEY}
          SUPABASE_SERVICE_ROLE_KEY: ${env.SUPABASE_SERVICE_ROLE_KEY}
          DEEPGRAM_API_URL: ${env.DEEPGRAM_API_URL}
          DEEPGRAM_API_KEY: ${env.DEEPGRAM_API_KEY}
          DASHSCOPE_API_KEY: ${env.DASHSCOPE_API_KEY}
          DASHSCOPEVIDEO_API_KEY: ${env.DASHSCOPEVIDEO_API_KEY}
          DASHSCOPEIMAGE_API_KEY: ${env.DASHSCOPEIMAGE_API_KEY}
          AZURE_KEY: ${env.AZURE_KEY}
          AZURE_REGION: ${env.AZURE_REGION}
          RAPIDAPI_KEY: ${env.RAPIDAPI_KEY}
          AIRWALLEX_CLIENT_ID: ${env.AIRWALLEX_CLIENT_ID}
          AIRWALLEX_API_KEY: ${env.AIRWALLEX_API_KEY}
          AIRWALLEX_BASE_URL: ${env.AIRWALLEX_BASE_URL}
          AIRWALLEX_MERCHANT_ACCOUNT_ID: ${env.AIRWALLEX_MERCHANT_ACCOUNT_ID}
      triggers:
        - name: httpTrigger
          type: http
          config:
            authType: anonymous
            methods:
              - GET
              - POST
              - PUT
              - DELETE
              - OPTIONS
              - HEAD
            cors:
              allowCredentials: true
              allowHeaders:
                - Content-Type
                - Authorization
                - X-Requested-With
                - X-API-Key
                - Accept
                - Origin
                - Cache-Control
              allowMethods:
                - GET
                - POST
                - PUT
                - DELETE
                - OPTIONS
                - HEAD
              allowOrigins:
                - 'http://localhost:3000'
                - 'https://matrix-4hv.pages.dev'
                - 'http://localhost:3001'
                - 'http://localhost:3002'
                - 'https://matrixaiglobal.com'
                - 'https://www.matrixaiglobal.com'
                - 'https://matrixai.asia'
              exposeHeaders:
                - Content-Length
                - Content-Type
                - X-API-Key
              maxAge: 86400